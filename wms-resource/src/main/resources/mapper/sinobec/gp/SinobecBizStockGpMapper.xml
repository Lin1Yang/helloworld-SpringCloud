<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.inossem.wms.dao.sinobec.gp.SinobecBizStockGpMapper">
  <resultMap id="BaseResultMap" type="com.inossem.wms.model.sinobec.gp.SinobecBizStockGp">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed May 06 16:30:55 CST 2020.
    -->
    <result column="bundle_code" jdbcType="VARCHAR" property="bundleCode" />
    <result column="heat_code" jdbcType="VARCHAR" property="heatCode" />
    <result column="skid_code" jdbcType="VARCHAR" property="skidCode" />
    <result column="shipping_ref" jdbcType="VARCHAR" property="shippingRef" />
    <result column="po_code" jdbcType="VARCHAR" property="poCode" />
    <result column="po_rid" jdbcType="VARCHAR" property="poRid" />
    <result column="mat_code" jdbcType="VARCHAR" property="matCode" />
    <result column="weight_unit_code" jdbcType="VARCHAR" property="weightUnitCode" />
    <result column="weight_qty" jdbcType="DECIMAL" property="weightQty" />
    <result column="receipt_unit_code" jdbcType="VARCHAR" property="receiptUnitCode" />
    <result column="receipt_qty" jdbcType="DECIMAL" property="receiptQty" />
    <result column="corp_code" jdbcType="VARCHAR" property="corpCode" />
    <result column="wh_code" jdbcType="VARCHAR" property="whCode" />
    <result column="item_numb" jdbcType="VARCHAR" property="itemNumb" />
    <result column="item_desc" jdbcType="VARCHAR" property="itemDesc" />
    <result column="lot_numb" jdbcType="VARCHAR" property="lotNumb" />
    <result column="stock_status" jdbcType="VARCHAR" property="stockStatus" />
    <result column="input_date" jdbcType="TIMESTAMP" property="inputDate" />
  </resultMap>
  <insert id="insert" parameterType="com.inossem.wms.model.sinobec.gp.SinobecBizStockGp">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed May 06 16:30:55 CST 2020.
    -->
    insert into sinobec_biz_stock_gp (bundle_code, heat_code, skid_code, 
      shipping_ref, po_code, po_rid, 
      mat_code, weight_unit_code, weight_qty, 
      receipt_unit_code, receipt_qty, corp_code, 
      wh_code, item_numb, item_desc, 
      lot_numb, stock_status, input_date
      )
    values (#{bundleCode,jdbcType=VARCHAR}, #{heatCode,jdbcType=VARCHAR}, #{skidCode,jdbcType=VARCHAR}, 
      #{shippingRef,jdbcType=VARCHAR}, #{poCode,jdbcType=VARCHAR}, #{poRid,jdbcType=VARCHAR}, 
      #{matCode,jdbcType=VARCHAR}, #{weightUnitCode,jdbcType=VARCHAR}, #{weightQty,jdbcType=DECIMAL}, 
      #{receiptUnitCode,jdbcType=VARCHAR}, #{receiptQty,jdbcType=DECIMAL}, #{corpCode,jdbcType=VARCHAR}, 
      #{whCode,jdbcType=VARCHAR}, #{itemNumb,jdbcType=VARCHAR}, #{itemDesc,jdbcType=VARCHAR}, 
      #{lotNumb,jdbcType=VARCHAR}, #{stockStatus,jdbcType=VARCHAR}, #{inputDate,jdbcType=TIMESTAMP}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.inossem.wms.model.sinobec.gp.SinobecBizStockGp">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed May 06 16:30:55 CST 2020.
    -->
    insert into sinobec_biz_stock_gp
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="bundleCode != null">
        bundle_code,
      </if>
      <if test="heatCode != null">
        heat_code,
      </if>
      <if test="skidCode != null">
        skid_code,
      </if>
      <if test="shippingRef != null">
        shipping_ref,
      </if>
      <if test="poCode != null">
        po_code,
      </if>
      <if test="poRid != null">
        po_rid,
      </if>
      <if test="matCode != null">
        mat_code,
      </if>
      <if test="weightUnitCode != null">
        weight_unit_code,
      </if>
      <if test="weightQty != null">
        weight_qty,
      </if>
      <if test="receiptUnitCode != null">
        receipt_unit_code,
      </if>
      <if test="receiptQty != null">
        receipt_qty,
      </if>
      <if test="corpCode != null">
        corp_code,
      </if>
      <if test="whCode != null">
        wh_code,
      </if>
      <if test="itemNumb != null">
        item_numb,
      </if>
      <if test="itemDesc != null">
        item_desc,
      </if>
      <if test="lotNumb != null">
        lot_numb,
      </if>
      <if test="stockStatus != null">
        stock_status,
      </if>
      <if test="inputDate != null">
        input_date,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="bundleCode != null">
        #{bundleCode,jdbcType=VARCHAR},
      </if>
      <if test="heatCode != null">
        #{heatCode,jdbcType=VARCHAR},
      </if>
      <if test="skidCode != null">
        #{skidCode,jdbcType=VARCHAR},
      </if>
      <if test="shippingRef != null">
        #{shippingRef,jdbcType=VARCHAR},
      </if>
      <if test="poCode != null">
        #{poCode,jdbcType=VARCHAR},
      </if>
      <if test="poRid != null">
        #{poRid,jdbcType=VARCHAR},
      </if>
      <if test="matCode != null">
        #{matCode,jdbcType=VARCHAR},
      </if>
      <if test="weightUnitCode != null">
        #{weightUnitCode,jdbcType=VARCHAR},
      </if>
      <if test="weightQty != null">
        #{weightQty,jdbcType=DECIMAL},
      </if>
      <if test="receiptUnitCode != null">
        #{receiptUnitCode,jdbcType=VARCHAR},
      </if>
      <if test="receiptQty != null">
        #{receiptQty,jdbcType=DECIMAL},
      </if>
      <if test="corpCode != null">
        #{corpCode,jdbcType=VARCHAR},
      </if>
      <if test="whCode != null">
        #{whCode,jdbcType=VARCHAR},
      </if>
      <if test="itemNumb != null">
        #{itemNumb,jdbcType=VARCHAR},
      </if>
      <if test="itemDesc != null">
        #{itemDesc,jdbcType=VARCHAR},
      </if>
      <if test="lotNumb != null">
        #{lotNumb,jdbcType=VARCHAR},
      </if>
      <if test="stockStatus != null">
        #{stockStatus,jdbcType=VARCHAR},
      </if>
      <if test="inputDate != null">
        #{inputDate,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  
  <delete id="deleteAll" >
  
  	delete  from sinobec_biz_stock_gp
  </delete>
  
  
  <insert id="insertList" parameterType="java.util.List" >
  insert into sinobec_biz_stock_gp (bundle_code, heat_code, skid_code, 
      shipping_ref, po_code, po_rid, 
      mat_code, weight_unit_code, weight_qty, 
      receipt_unit_code, receipt_qty, corp_code, 
      wh_code, item_numb, item_desc, 
      lot_numb, stock_status, input_date
      )
      
    values
    <foreach collection="list" item="item" index= "index" separator =",">
    
     (#{item.bundleCode,jdbcType=VARCHAR}, #{item.heatCode,jdbcType=VARCHAR}, #{item.skidCode,jdbcType=VARCHAR}, 
      #{item.shippingRef,jdbcType=VARCHAR}, ifnull(#{item.poCode,jdbcType=VARCHAR},''), ifnull(#{item.poRid,jdbcType=VARCHAR},''),
      #{item.matCode,jdbcType=VARCHAR}, #{item.weightUnitCode,jdbcType=VARCHAR}, #{item.weightQty,jdbcType=DECIMAL}, 
      #{item.receiptUnitCode,jdbcType=VARCHAR}, #{item.receiptQty,jdbcType=DECIMAL}, #{item.corpCode,jdbcType=VARCHAR}, 
      #{item.whCode,jdbcType=VARCHAR}, #{item.itemNumb,jdbcType=VARCHAR}, #{item.itemDesc,jdbcType=VARCHAR}, 
      #{item.lotNumb,jdbcType=VARCHAR}, #{item.stockStatus,jdbcType=VARCHAR}, #{item.inputDate,jdbcType=TIMESTAMP}
      )
     </foreach>
  	ON  DUPLICATE  KEY  UPDATE  
  	  mat_code = values(mat_code),
      corp_code = values(corp_code),
      wh_code = values(wh_code),
      stock_status = values(stock_status),
      item_numb = values(item_numb),
      item_desc = values(item_desc),
      lot_numb = values(lot_numb),
      receipt_unit_code = values(receipt_unit_code),
      receipt_qty = values(receipt_qty),
      weight_unit_code = values(weight_unit_code),
      weight_qty = values(weight_qty),
 	  input_date = values(input_date)
  </insert>

  <select id="selectStockCorpToChangeListOnPaging" resultType="com.inossem.wms.model.sinobec.stock.SinobecStockVo">
        select  stock_gp.shipping_ref,
                stock_gp.po_code,
                stock_gp.mat_code,
                stock_gp.heat_code,
                stock_gp.skid_code,
                stock_gp.weight_unit_code,
                stock_gp.weight_qty weight_qty_gp,
                stock_gp.receipt_unit_code,
                stock_gp.receipt_qty receipt_qty_gp,
                stock_gp.corp_code corp_code_gp,
                stock_gp.wh_code,
                stock_gp.item_numb,
                stock_gp.item_desc,
                stock_gp.lot_numb,
                stock_gp.stock_status,
                stock_gp.input_date,
                sbi.corp_code corp_code_ins,
                stock_ins.weight_qty weight_qty_ins,
                stock_ins.receipt_qty receipt_qty_ins,m.mat_name
          from sinobec_biz_stock_gp stock_gp
          inner join sinobec_stock stock_ins
               on stock_gp.bundle_code = stock_ins.bundle_code and stock_gp.corp_code != sbi.corp_code
        <if test=" bundleCode != null and bundleCode !='' ">
          and stock_gp.bundle_code = #{bundleCode}
        </if>
        <if test=" whCode != null and whCode !='' ">
          and stock_gp.wh_code = #{whCode}
        </if>
        <if test=" typeCode != null and typeCode !='' ">
          and stock_gp.type_code = #{typeCode}
        </if>
        <if test=" binCode != null and binCode !='' ">
          and stock_gp.bin_code = #{binCode}
        </if>
        <if test=" receiptCode != null and receiptCode !='' ">
          and stock_gp.receipt_code = #{receiptCode}
        </if>
        <if test=" heatCode != null and heatCode !='' ">
          and stock_gp.heat_code = #{heatCode}
        </if>
        <if test=" skidCode != null and skidCode !='' ">
          and stock_gp.skid_code = #{skidCode}
        </if>
        <if test=" shippingRef != null and shippingRef !='' ">
          and stock_gp.shipping_ref = #{shippingRef}
        </if>
        <if test="@com.inossem.wms.page.PageInterceptor@isNotEmpty(condition)">
            and (stock_gp.po_code   like CONCAT('%',#{condition},'%')
            or stock_gp.shipping_ref  like CONCAT('%',#{condition},'%')
            or stock_gp.corp_code  like  CONCAT('%',#{condition},'%')
            or stock_gp.skid_code  like CONCAT('%',#{condition},'%')
            or stock_gp.mat_code like CONCAT('%',#{condition},'%')
            or stock_gp.heat_code like CONCAT('%',#{condition},'%')
            or stock_gp.bundle_code like CONCAT('%',#{condition},'%')
            )
          </if>
        inner join sinobec_dic_bundle_info sbi
            on sbi.bundle_code = stock_gp.bundle_code
        inner join dic_material m on m.mat_code =stock_gp.mat_code
  </select>
    <update id="changeCorp">
    update sinobec_dic_bundle_info sbi
    inner join sinobec_biz_stock_gp stock_gp
        on sbi.bundle_code = stock_gp.bundle_code
        set sbi.corp_code = stock_gp.corp_code
        where sbi.corp_code != stock_gp.corp_code
    </update>

</mapper>